# GitHub Actions 自动发布配置

本项目配置了 GitHub Actions 工作流，可以在推送版本标签时自动创建 GitHub Release。

## 工作流配置

工作流文件位于 `.github/workflows/release.yml`，主要功能包括：

### 触发条件
- 推送以 `v` 开头的标签时触发（如 `v1.0.0`、`v1.2.3` 等）

### 自动化步骤
1. **代码检出** - 获取完整的 Git 历史记录
2. **环境设置** - 配置 Node.js 18 环境
3. **依赖安装** - 运行 `npm ci` 安装依赖
4. **项目构建** - 运行 `npm run build` 构建项目
5. **测试执行** - 运行 `npm run test:features` 执行特性测试
6. **版本提取** - 从标签中提取版本号
7. **变更日志生成** - 自动对比上一个版本标签，生成详细的变更记录
8. **Release 创建** - 创建包含详细信息的 GitHub Release

### 变更日志功能
工作流会自动生成详细的版本变更日志，包括：
- **提交记录** - 显示两个版本之间的所有提交信息
- **统计信息** - 提交数量和修改文件数量
- **文件变更** - 详细列出新增、修改、删除和重命名的文件
- **图标标识** - 使用 emoji 图标增强可读性

## 使用方法

### 1. 创建版本标签

```bash
# 确保代码已提交并推送到远程仓库
git add .
git commit -m "Release version 1.0.6"
git push origin main

# 创建并推送版本标签
git tag v1.0.6
git push origin v1.0.6
```

### 2. 自动发布流程

推送标签后，GitHub Actions 将自动：
- 运行所有测试确保代码质量
- 构建项目
- 生成变更日志
- 创建 GitHub Release

### 3. Release 内容

自动创建的 Release 包含：
- **版本信息** - 从标签提取的版本号
- **安装说明** - NPM 包安装命令
- **功能特性** - 项目主要功能列表
- **测试结果** - 构建和测试状态
- **变更日志** - 与上一版本的差异
- **文档链接** - 相关文档的链接

## 注意事项

1. **标签格式** - 必须以 `v` 开头，如 `v1.0.0`
2. **测试通过** - 只有在所有测试通过时才会创建 Release
3. **权限要求** - 需要 `contents: write` 权限来创建 Release
4. **版本同步** - 确保 `package.json` 中的版本与标签版本一致

## 手动发布

如果需要手动发布，可以使用项目中的 `publish.sh` 脚本：

```bash
./publish.sh
```

该脚本会：
- 运行测试
- 更新版本号
- 创建标签
- 发布到 NPM
- 触发 GitHub Actions 创建 Release

## 故障排除

如果 GitHub Actions 失败，请检查：
1. 测试是否全部通过
2. 构建是否成功
3. 标签格式是否正确
4. 仓库权限是否足够

查看详细日志可以在 GitHub 仓库的 Actions 标签页中找到。