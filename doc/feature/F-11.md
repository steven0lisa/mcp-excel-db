# F-11: UNION 和 UNION ALL 支持

## 概述
Excel SQL Query 功能扩展支持 UNION 和 UNION ALL 操作，允许用户合并多个 SELECT 查询的结果集。

## 支持的语法

### UNION (去重合并)
```sql
SELECT columns FROM table1
UNION
SELECT columns FROM table2
```

### UNION ALL (保留重复)
```sql
SELECT columns FROM table1
UNION ALL
SELECT columns FROM table2
```

### 多表 UNION
```sql
SELECT columns FROM table1
UNION
SELECT columns FROM table2
UNION ALL
SELECT columns FROM table3
```

## 参数说明
- `columns`: 要选择的列名，所有查询的列数和类型必须匹配
- `table1`, `table2`, `table3`: 工作表名称
- `UNION`: 合并结果并去除重复行
- `UNION ALL`: 合并结果并保留所有重复行

## 使用示例

### 基本 UNION 示例
假设有两个工作表：
- `employees_2023` (2023年员工表): employee_id, name, department
- `employees_2024` (2024年员工表): employee_id, name, department

```sql
-- 查询所有年份的唯一员工姓名
SELECT name FROM employees_2023
UNION
SELECT name FROM employees_2024
```

### UNION ALL 示例
```sql
-- 查询所有年份的员工姓名（包含重复）
SELECT name FROM employees_2023
UNION ALL
SELECT name FROM employees_2024
```

### 带 WHERE 子句的 UNION
```sql
-- 查询销售部门的所有员工
SELECT name FROM employees_2023 WHERE department = 'Sales'
UNION
SELECT name FROM employees_2024 WHERE department = 'Sales'
```

### 多列 UNION
```sql
-- 查询所有订单信息
SELECT customer_id, product_id, amount FROM orders_2023
UNION
SELECT customer_id, product_id, amount FROM orders_2024
```

## 实现细节

### AST 结构
```javascript
{
  type: 'union',
  distinct: true, // true for UNION, false for UNION ALL
  selects: [
    {
      type: 'select',
      columns: [...],
      from: [...]
    },
    {
      type: 'select',
      columns: [...],
      from: [...]
    }
  ]
}
```

### 合并算法
1. **UNION**: 执行所有 SELECT 查询，合并结果，然后去除重复行
2. **UNION ALL**: 执行所有 SELECT 查询，简单合并所有结果

### 性能考虑
- 先执行所有子查询，获取完整结果集
- 使用 Set 数据结构进行去重操作（UNION）
- 保持原始列顺序和数据类型
- 支持任意数量的子查询合并

### 错误处理
- 列数不匹配时抛出错误
- 表不存在时抛出错误
- 列名不存在时抛出错误
- 子查询语法错误时抛出错误

## 局限性
- 不支持 ORDER BY 子句（在 UNION 结果上）
- 不支持 LIMIT 子句（在 UNION 结果上）
- 不支持复杂的子查询嵌套
- 所有子查询必须返回相同数量的列

## 测试用例
测试用例位于 `test/test-case/tc-f-11.js`

## 相关特性
- F-1: 基础 SELECT 查询
- F-5: WHERE 子句支持
- F-3: 表别名支持