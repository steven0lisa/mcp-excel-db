# F-15: 工作表名称和列信息一致性测试

## 特性描述

本特性专门测试和修复 Excel-DB MCP 工具中工作表名称识别和列信息获取的一致性问题，确保用户体验的连贯性和可靠性。

## 功能说明

### 1. 工作表名称一致性
- 确保 `get_worksheet_info` 返回的工作表名称与实际 SQL 查询中可用的名称完全一致
- 统一不同文件大小和处理模式下的工作表命名规则
- 处理默认工作表名称（Sheet vs Sheet1）的标准化

### 2. 列信息获取可靠性
- 验证 `get_worksheet_columns` 能够正确返回所有列名
- 确保列名格式与实际数据中的列名完全匹配
- 处理大小写敏感性和特殊字符

### 3. 错误消息一致性
- 提供清晰、准确的错误消息
- 确保错误消息中的工作表名称与用户看到的一致
- 改进边界情况的错误处理

## 支持的测试场景

### 工作表命名测试
- 单工作表文件（默认命名 Sheet vs Sheet1）
- 多工作表文件的名称识别
- 自定义工作表名称
- 包含特殊字符的工作表名称
- 不同文件大小下的命名一致性

### 列信息测试
- 空文件的列信息处理
- 单行标题文件
- 多行数据文件
- 包含特殊字符的列名
- 大小写混合的列名
- 流处理模式下的列信息获取

### 错误处理测试
- 不存在的工作表查询
- 不存在的列名引用
- 无效的 SQL 语法
- 损坏的文件格式
- 文件大小限制测试

## 使用示例

### 基本工作表信息获取
```javascript
// 获取工作表信息
const worksheetInfo = await excelQuery.getWorksheetInfo('test-file.xlsx');
console.log('工作表:', worksheetInfo.map(w => w.table_name));

// 使用返回的名称进行查询
const tableName = worksheetInfo[0].table_name;
const result = await excelQuery.executeQuery(`SELECT * FROM ${tableName} LIMIT 5`, 'test-file.xlsx');
```

### 列信息获取和验证
```javascript
// 获取列信息
const columnInfo = await excelQuery.getWorksheetColumns('test-file.xlsx');
console.log('列名:', columnInfo[0].columns);

// 使用实际列名进行查询
const columns = columnInfo[0].columns.join(', ');
const result = await excelQuery.executeQuery(`SELECT ${columns} FROM Sheet1`, 'test-file.xlsx');
```

## 实现细节

### 工作表名称标准化
1. 统一使用 ExcelJS 的 `worksheet.name` 属性
2. 为流处理模式添加名称获取逻辑
3. 确保 CSV 文件始终使用 "Sheet" 作为工作表名

### 列信息获取优化
1. 改进流处理模式下的列名提取
2. 添加列名验证和清理逻辑
3. 处理空值和特殊字符

### 错误处理改进
1. 提供更详细的错误上下文
2. 统一错误消息格式
3. 添加建议性的错误解决方案

## 注意事项

1. **性能考虑**：大文件处理时优先使用流模式，但确保名称一致性
2. **向后兼容**：保持现有 API 接口不变
3. **错误恢复**：流处理失败时自动回退到标准模式
4. **内存管理**：避免在获取基本信息时加载完整数据

## 对应测试用例位置

测试用例文件：`test/test-case/tc-f-15.js`

测试覆盖：
- 工作表名称一致性测试
- 列信息获取可靠性测试  
- 错误处理和消息测试
- 不同文件格式和大小的兼容性测试
- SQL 查询与信息获取的集成测试