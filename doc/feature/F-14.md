# F-14: Large File Processing (>100MB Excel Files)

## Feature Description
Enhanced support for processing large Excel files (>100MB) with optimized memory usage and error handling. This feature addresses the "Invalid string length" errors that can occur when processing very large Excel files by implementing file size validation, memory optimization, and improved error handling.

## Supported Operations
- `get_worksheet_info` - Get worksheet names from large Excel files
- `get_worksheet_columns` - Get column information from large Excel files  
- `execute_sql_query` - Execute SQL queries on large Excel files with memory optimization

## File Size Limits
- **Maximum supported file size**: 200MB
- **Warning threshold**: 100MB (shows performance warning but continues processing)
- **Recommended file size**: <50MB for optimal performance
- **Stream processing row limit**: 100,000 rows (configurable for memory protection)

## Key Features

### 1. File Size Validation
- Automatic file size checking before processing
- Clear error messages for files exceeding limits
- Performance warnings for large files

### 2. Memory Optimization
- Uses stream processing for files >50MB with `ExcelJS.stream.xlsx.WorkbookReader`
- Row limit protection (100,000 rows) to prevent memory overflow
- Optimized memory usage patterns
- Prevents JavaScript string length limit errors

### 3. Enhanced Error Handling
- Specific error messages for "Invalid string length" errors
- Resource exhaustion detection (EMFILE, ENOMEM)

### 4. Test File Management
- Test cases gracefully handle missing `bigexcel.xlsx` file
- Appropriate warnings when test file is not available (expected in CI/CD)
- Skips large file tests when test data is not present
- User-friendly error messages with actionable suggestions

## Usage Examples

### Get Worksheet Information from Large File
```javascript
const excelQuery = new ExcelSqlQuery();
const worksheets = await excelQuery.getWorksheetInfo('large-file.xlsx');
console.log('Worksheets:', worksheets.map(w => w.table_name));
```

### Get Column Information
```javascript
const columns = await excelQuery.getWorksheetColumns('large-file.xlsx', 'Sheet1');
console.log('Columns:', columns[0].columns);
```

### Execute SQL Query with LIMIT (Recommended for Large Files)
```sql
SELECT * FROM Sheet1 LIMIT 100
```

## Performance Considerations

### Best Practices for Large Files
1. **Use LIMIT clauses** in SQL queries to avoid loading entire datasets
2. **Process specific worksheets** rather than all worksheets at once
3. **Monitor memory usage** during processing
4. **Close other applications** to free up system resources

### Expected Performance
- **100MB file**: 10-30 seconds processing time
- **150MB file**: 30-60 seconds processing time  
- **200MB file**: 60-120 seconds processing time

*Note: Performance varies based on system specifications and file complexity*

## Error Handling

### Common Error Scenarios
1. **File too large (>200MB)**
   - Error: "File too large (XXX MB). Maximum supported size is 200MB"
   - Solution: Split file into smaller chunks or use a different tool

2. **JavaScript string length limit exceeded**
   - Error: "File too large or corrupted. The file exceeds JavaScript string length limits"
   - Solution: Use a smaller file or split the data

3. **Insufficient system resources**
   - Error: "Insufficient system resources. Try closing other applications"
   - Solution: Free up memory or process a smaller file

## Implementation Details

### Technical Improvements
- **File size checking**: Pre-validates file size before processing
- **Memory-optimized loading**: Uses `workbook.xlsx.readFile()` instead of streaming
- **Error categorization**: Specific handling for different error types
- **Performance monitoring**: Logs processing time and file size information

### Code Changes
- Modified `getWorksheetInfo()` method with size validation
- Enhanced `getWorksheetColumns()` method with memory optimization
- Improved `executeQuery()` method with large file support
- Added comprehensive error handling for all methods

## Test Cases
Corresponding test cases are located in `test/test-case/tc-f-14.js`

### Test Coverage
- File size validation and warnings
- Worksheet information extraction from large files
- Column information extraction with performance monitoring
- SQL query execution with LIMIT clauses
- Memory usage validation
- Error handling for various failure scenarios

## Limitations
- Maximum file size is 200MB due to JavaScript engine limitations
- Very large files may require significant processing time
- Memory usage scales with file size and complexity
- Some extremely complex Excel files may still cause memory issues

## Future Enhancements
- Streaming-based processing for even larger files
- Chunked data loading for better memory management
- Progress indicators for long-running operations
- Configurable memory limits and processing options