# F-16: 列信息获取和大小写敏感性测试

## 特性描述

F-16 特性专门测试 Excel-DB MCP 工具中列信息获取功能的准确性、大小写处理逻辑和格式兼容性。该测试确保 `getWorksheetColumns` 方法能够正确识别和返回各种格式的列名，并且返回的列名可以直接用于 SQL 查询。

## 功能规范

### 1. 列信息获取准确性
- **基本列名识别**: 正确识别标准英文列名
- **大小写保持**: 保持原始列名的大小写格式
- **特殊字符支持**: 支持包含特殊字符的列名（中文、符号等）
- **空列名处理**: 为空列名生成合适的默认名称

### 2. 格式兼容性
- **Excel 文件支持**: 支持 .xlsx 格式的多种列名格式
- **CSV 文件支持**: 正确处理 CSV 文件的列名
- **多工作表支持**: 能够获取多个工作表的列信息
- **大文件性能**: 在合理时间内处理包含大量列的文件

### 3. 查询一致性
- **列名可用性**: 返回的列名必须可以直接用于 SQL 查询
- **引用规则**: 正确处理需要引号的特殊列名
- **错误处理**: 提供清晰的错误信息

## 支持的测试场景

### 基础测试
```javascript
// 基本列信息获取
const columnInfo = await excelQuery.getWorksheetColumns('basic-file.xlsx');
// 验证返回的列名与实际列名匹配

// 使用返回的列名进行查询
const result = await excelQuery.executeQuery(`SELECT ${columnName} FROM Sheet1`, 'basic-file.xlsx');
```

### 大小写敏感性测试
```javascript
// 混合大小写列名文件
// 列名: ['PAT_Type', 'GeoSize', 'CAI', 'user_ID']
const mixedCaseInfo = await excelQuery.getWorksheetColumns('mixed-case.xlsx');
// 验证大小写完全匹配
```

### 特殊字符测试
```javascript
// 特殊字符列名
// 列名: ['姓名', 'Email@Address', 'Phone#Number', 'Data-Value']
const specialCharInfo = await excelQuery.getWorksheetColumns('special-chars.xlsx');
// 验证特殊字符列名的正确处理
```

### 性能测试
```javascript
// 大文件列信息获取
const startTime = Date.now();
const largeFileInfo = await excelQuery.getWorksheetColumns('large-file.xlsx');
const duration = Date.now() - startTime;
// 验证在合理时间内完成（< 5秒）
```

## 使用示例

### 示例 1: 基本列信息获取
```javascript
const { ExcelSqlQuery } = require('excel-sql-query');
const excelQuery = new ExcelSqlQuery();

// 获取列信息
const columnInfo = await excelQuery.getWorksheetColumns('data.xlsx');
console.log('列名:', columnInfo[0].columns);

// 使用列名查询
const columns = columnInfo[0].columns.slice(0, 3).join(', ');
const result = await excelQuery.executeQuery(`SELECT ${columns} FROM Sheet1 LIMIT 5`, 'data.xlsx');
```

### 示例 2: 处理特殊字符列名
```javascript
// 包含特殊字符的列名需要使用反引号
const specialColumns = ['姓名', 'Email@Address'];
const query = `SELECT \`${specialColumns[0]}\`, \`${specialColumns[1]}\` FROM Sheet1`;
const result = await excelQuery.executeQuery(query, 'special-data.xlsx');
```

### 示例 3: 多工作表列信息
```javascript
const multiSheetInfo = await excelQuery.getWorksheetColumns('multi-sheet.xlsx');
multiSheetInfo.forEach(sheet => {
  console.log(`工作表 ${sheet.table_name} 的列:`, sheet.columns);
});
```

## 实现细节

### 测试用例覆盖
1. **基本列信息获取**: 验证标准列名的正确识别
2. **大小写混合处理**: 测试各种大小写组合的列名
3. **特殊字符支持**: 测试中文、符号等特殊字符列名
4. **空列名处理**: 验证空列名的默认命名规则
5. **CSV 文件支持**: 测试 CSV 格式的列名获取
6. **大文件性能**: 验证大量列的处理性能
7. **多工作表支持**: 测试多个工作表的列信息获取
8. **查询一致性**: 验证返回的列名可以直接用于查询

### 性能要求
- 大文件（50+ 列，100+ 行）处理时间 < 5 秒
- 内存使用合理，避免内存泄漏
- 支持流式处理大文件

### 错误处理
- 文件不存在时提供清晰错误信息
- 损坏文件的优雅处理
- 不支持格式的明确提示

## 注意事项

### 1. 列名引用规则
- 标准列名可以直接使用
- 包含特殊字符的列名需要使用反引号 `` ` ``
- 空格和特殊符号需要特别处理

### 2. 性能考虑
- 大文件使用流式处理
- 避免加载整个文件到内存
- 只读取必要的行数来获取列信息

### 3. 兼容性
- 支持不同版本的 Excel 文件
- 兼容各种 CSV 编码格式
- 处理不同操作系统的文件路径

## 对应测试用例

测试用例位置: `test/test-case/tc-f-16.js`

运行测试:
```bash
node test/test.js
```

该测试用例包含 8 个主要测试场景，覆盖列信息获取的各个方面，确保功能的可靠性和一致性。